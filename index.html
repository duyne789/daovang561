<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>GOLD MINER PRO - @daovang51_bot</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        :root { --gold: #ffb703; --gold-dark: #fb8500; --bg: #0d1b2a; --card: #1b263b; --txt: #e0e1dd; }
        body { margin: 0; font-family: 'Segoe UI', Tahoma, sans-serif; background: var(--bg); color: var(--txt); overflow-x: hidden; }
        #server-status { position: fixed; top: 15px; left: 50%; transform: translateX(-50%); background: rgba(0,0,0,0.9); padding: 8px 20px; border-radius: 30px; font-size: 11px; z-index: 1000; border: 1px solid var(--gold); color: var(--gold); display: none; }
        .header { background: linear-gradient(180deg, var(--card) 0%, var(--bg) 100%); padding: 30px 20px; text-align: center; }
        .gold-val { font-size: 45px; font-weight: 900; color: var(--gold); text-shadow: 0 0 20px rgba(255,183,3,0.4); }
        .content { padding: 15px; padding-bottom: 120px; }
        .card { background: var(--card); border-radius: 24px; padding: 20px; margin-bottom: 15px; box-shadow: 0 10px 25px rgba(0,0,0,0.4); border: 1px solid #ffffff05; }
        .setting-box { background: rgba(0,0,0,0.3); padding: 12px; border-radius: 18px; display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; }
        .prog-container { background: #000; height: 16px; border-radius: 10px; margin: 15px 0; overflow: hidden; border: 1px solid #333; }
        .prog-bar { height: 100%; width: 0%; background: linear-gradient(90deg, var(--gold), #fff); box-shadow: 0 0 10px var(--gold); }
        .btn-main { background: linear-gradient(135deg, var(--gold), var(--gold-dark)); border: none; padding: 18px; border-radius: 18px; width: 100%; font-weight: 800; cursor: pointer; color: #000; font-size: 17px; }
        .btn-main:disabled { opacity: 0.5; }
        input, select { width: 100%; padding: 15px; margin: 8px 0; border-radius: 14px; border: 1px solid #333; background: #000; color: #fff; box-sizing: border-box; }
        .nav { position: fixed; bottom: 0; width: 100%; display: flex; background: var(--card); border-top: 1px solid #ffffff10; padding-bottom: env(safe-area-inset-bottom); }
        .nav-item { flex: 1; text-align: center; padding: 15px 5px; font-size: 10px; color: #64748b; font-weight: bold; }
        .nav-item.active { color: var(--gold); border-top: 3px solid var(--gold); }
        .tab { display: none; } .tab.active { display: block; }
        .shop-item { display: flex; justify-content: space-between; align-items: center; background: rgba(0,0,0,0.2); padding: 15px; border-radius: 15px; margin-bottom: 10px; }
        .rank-row { display: flex; justify-content: space-between; padding: 10px; border-bottom: 1px solid #ffffff05; }
    </style>
</head>
<body>

<div id="server-status">K·∫øt n·ªëi m√°y ch·ªß...</div>

<div class="header">
    <div id="user-display" style="font-size: 13px; color: #64748b;">@Guest</div>
    <div class="gold-val" id="gold-display">0</div>
</div>

<div class="content">
    <div id="tab-mine" class="tab active">
        <div class="card">
            <div class="setting-box">
                <span>TREO M√ÅY (GI√ÇY):</span>
                <input type="number" id="duration" value="30" min="30" style="width: 70px; text-align: center;">
            </div>
            <div id="tool-name" style="text-align: center; color: var(--gold); font-weight: bold;">CU·ªêC G·ªñ</div>
            <div id="mining-status" style="text-align: center; height: 30px; margin-top: 10px; font-weight: bold; color: #10b981;"></div>
            <div class="prog-container"><div class="prog-bar" id="prog"></div></div>
            <button class="btn-main" id="btn-mine" onclick="startMining()">‚õè B·∫ÆT ƒê·∫¶U ƒê√ÄO</button>
        </div>
    </div>

    <div id="tab-shop" class="tab">
        <div class="card">
            <h3>üõí C·ª≠a H√†ng</h3>
            <div class="shop-item"><div><b>Cu·ªëc S·∫Øt</b><br><small>40 v√†ng/s</small></div><button onclick="buyTool(1, 50000)" class="btn-main" style="width:80px; padding:10px" id="b1">50K</button></div>
            <div class="shop-item"><div><b>M√°y Khoan</b><br><small>120 v√†ng/s</small></div><button onclick="buyTool(2, 200000)" class="btn-main" style="width:80px; padding:10px" id="b2">200K</button></div>
        </div>
    </div>

    <div id="tab-rank" class="tab">
        <div class="card"><h3>üèÜ Top ƒê·∫°i Gia</h3><div id="rank-list">ƒêang t·∫£i...</div></div>
    </div>

    <div id="tab-friends" class="tab">
        <div class="card">
            <h3>üë• B·∫°n B√®</h3>
            <div id="ref-link" style="font-size:11px; color:var(--gold); border:1px dashed #555; padding:10px; margin-bottom:10px; word-break:break-all"></div>
            <button class="btn-main" onclick="copyRef()">COPY LINK M·ªúI</button>
            <p>ƒê√£ m·ªùi: <span id="ref-count" style="color:var(--gold)">0</span> b·∫°n</p>
        </div>
    </div>

    <div id="tab-wallet" class="tab">
        <div class="card">
            <h3>üí∞ R√∫t Ti·ªÅn</h3>
            <select id="wd-method" onchange="toggleWd()"><option value="Momo">V√≠ Momo</option><option value="Bank">Ng√¢n h√†ng</option></select>
            <div id="momo-fields"><input type="text" id="momo-num" placeholder="S·ªë Momo"></div>
            <div id="bank-fields" style="display:none"><input type="text" id="bank-name" placeholder="T√™n Ng√¢n h√†ng"><input type="text" id="bank-num" placeholder="S·ªë t√†i kho·∫£n"></div>
            <input type="text" id="acc-name" placeholder="T√™n ch·ªß t√†i kho·∫£n (VI·∫æT HOA)">
            <button class="btn-main" onclick="requestWithdraw()">R√öT 20,000 V√ÄNG</button>
        </div>
        <div class="card"><h4>üìú L·ªãch s·ª≠</h4><div id="history-list"></div></div>
    </div>
</div>

<div class="nav">
    <div class="nav-item active" onclick="showTab('mine', this)">‚õè ƒê√ÄO</div>
    <div class="nav-item" onclick="showTab('shop', this)">üõí SHOP</div>
    <div class="nav-item" onclick="showTab('rank', this)">üèÜ TOP</div>
    <div class="nav-item" onclick="showTab('friends', this)">üë• REF</div>
    <div class="nav-item" onclick="showTab('wallet', this)">üí∞ V√ç</div>
</div>

<script>
    const tg = window.Telegram.WebApp;
    const SCRIPT_URL = "D√ÅN_LINK_EXEC_C·ª¶A_B·∫†N_V√ÄO_ƒê√ÇY";
    const userId = tg.initDataUnsafe?.user?.id || "test_user";
    const userName = tg.initDataUnsafe?.user?.username || "Guest";
    const refBy = tg.initDataUnsafe?.start_param || "";

    let gold = 0, level = 0, isMining = false;
    const TOOLS = [{name:"CU·ªêC G·ªñ", power:10}, {name:"CU·ªêC S·∫ÆT", power:40}, {name:"M√ÅY KHOAN", power:120}];

    function notify(t, b=true){ const s=document.getElementById('server-status'); s.style.display='block'; s.innerText=t; if(!b) setTimeout(()=>s.style.display='none', 2000); }

    async function loadData() {
        notify("K·∫øt n·ªëi Server...");
        try {
            const r = await fetch(`${SCRIPT_URL}?action=load&userId=${userId}`);
            const d = await r.json();
            gold = d.gold; level = d.level;
            document.getElementById('ref-count').innerText = d.refCount;
            renderRank(d.ranks);
            renderHistory(d.history);
            updateUI();
            notify("K·∫øt n·ªëi th√†nh c√¥ng", false);
        } catch(e){ notify("L·ªói k·∫øt n·ªëi!", false); }
    }

    function updateUI() {
        document.getElementById('gold-display').innerText = gold.toLocaleString();
        document.getElementById('user-display').innerText = "@" + userName;
        document.getElementById('tool-name').innerText = "C√îNG C·ª§: " + TOOLS[level].name;
        document.getElementById('ref-link').innerText = `https://t.me/daovang51_bot?start=${userId}`;
        if(level>=1) { document.getElementById('b1').innerText="OK"; document.getElementById('b1').disabled=true; }
        if(level>=2) { document.getElementById('b2').innerText="OK"; document.getElementById('b2').disabled=true; }
    }

    function startMining() {
        if(isMining) return;
        const dur = Math.max(30, parseInt(document.getElementById('duration').value) || 30);
        isMining = true;
        let elapsed = 0;
        document.getElementById('btn-mine').disabled = true;
        let timer = setInterval(() => {
            elapsed++;
            let earned = elapsed * TOOLS[level].power;
            document.getElementById('mining-status').innerText = `‚õè ƒêang ƒë√†o: +${earned.toLocaleString()} v√†ng`;
            document.getElementById('prog').style.width = (elapsed/dur)*100+"%";
            if(elapsed >= dur) {
                clearInterval(timer);
                isMining = false;
                document.getElementById('btn-mine').disabled = false;
                document.getElementById('prog').style.width = "0%";
                gold += earned;
                document.getElementById('mining-status').innerText = `‚úÖ ƒê√£ nh·∫≠n +${earned.toLocaleString()} v√†ng!`;
                updateUI();
                saveData();
                tg.HapticFeedback.notificationOccurred('success');
            }
        }, 1000);
    }

    function saveData() {
        fetch(SCRIPT_URL, { method: "POST", mode: "no-cors", body: JSON.stringify({ action: "save", userId, gold, level, userName, refBy }) });
    }

    function buyTool(idx, p) {
        if(gold < p) return alert("Kh√¥ng ƒë·ªß v√†ng!");
        gold -= p; level = idx; updateUI(); saveData(); alert("N√¢ng c·∫•p th√†nh c√¥ng!");
    }

    function toggleWd() {
        const m = document.getElementById('wd-method').value;
        document.getElementById('momo-fields').style.display = m==='Momo'?'block':'none';
        document.getElementById('bank-fields').style.display = m==='Bank'?'block':'none';
    }

    function requestWithdraw() {
        if(gold < 20000) return alert("C·∫ßn t·ªëi thi·ªÉu 20,000 v√†ng!");
        const name = document.getElementById('acc-name').value;
        if(!name) return alert("Nh·∫≠p t√™n ch·ªß th·∫ª!");
        notify("ƒêang g·ª≠i...");
        fetch(SCRIPT_URL, { method: "POST", mode: "no-cors", body: JSON.stringify({ action: "withdraw", userId, amount: 20000, info: "R√∫t ti·ªÅn ("+name+")", method: document.getElementById('wd-method').value }) })
        .then(() => { gold -= 20000; updateUI(); alert("G·ª≠i y√™u c·∫ßu th√†nh c√¥ng!"); loadData(); });
    }

    function renderRank(ranks) {
        if(!ranks) return;
        document.getElementById('rank-list').innerHTML = ranks.map((r, i) => `<div class="rank-row"><span>${i+1}. ${r.name}</span><b>${r.gold.toLocaleString()}</b></div>`).join('');
    }

    function renderHistory(h) {
        if(!h || h.length === 0) return document.getElementById('history-list').innerText = "Ch∆∞a c√≥ GD";
        document.getElementById('history-list').innerHTML = h.map(i => `<div class="rank-row"><span>R√∫t 20k</span><span style="color:orange">${i.status}</span></div>`).join('');
    }

    function copyRef() { navigator.clipboard.writeText(document.getElementById('ref-link').innerText); alert("ƒê√£ copy!"); }
    function showTab(id, el) {
        document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
        document.getElementById('tab-' + id).classList.add('active');
        document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
        el.classList.add('active');
    }
    loadData();
</script>
</body>
</html>
