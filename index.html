<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>GOLD MINER PRO</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        :root { --gold: #ffb703; --gold-dark: #fb8500; --bg: #0d1b2a; --card: #1b263b; --txt: #e0e1dd; }
        body { margin: 0; font-family: 'Inter', sans-serif; background: var(--bg); color: var(--txt); overflow-x: hidden; }
        
        /* Header */
        .header { background: linear-gradient(180deg, var(--card) 0%, var(--bg) 100%); padding: 20px; text-align: center; border-bottom: 1px solid #ffffff10; }
        .user-badge { background: #ffffff10; padding: 5px 15px; border-radius: 20px; font-size: 12px; color: var(--gold); }

        /* Main Card */
        .content { padding: 20px; padding-bottom: 100px; }
        .card { background: var(--card); border-radius: 24px; padding: 25px; margin-bottom: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.3); border: 1px solid #ffffff05; position: relative; overflow: hidden; }
        .gold-val { font-size: 48px; font-weight: 800; color: var(--gold); margin: 10px 0; text-shadow: 0 0 20px rgba(255, 183, 3, 0.3); }
        
        /* Mining Progress */
        .prog-container { background: #00000040; height: 16px; border-radius: 30px; margin: 25px 0; border: 1px solid #ffffff10; overflow: hidden; }
        .prog-bar { height: 100%; width: 0%; background: linear-gradient(90deg, var(--gold), #fff); box-shadow: 0 0 15px var(--gold); transition: width 0.1s linear; }

        /* Buttons */
        .btn-main { background: linear-gradient(135deg, var(--gold) 0%, var(--gold-dark) 100%); border: none; padding: 18px; border-radius: 18px; width: 100%; font-size: 18px; font-weight: bold; color: #000; cursor: pointer; box-shadow: 0 5px 15px rgba(251, 133, 0, 0.4); }
        .btn-main:active { transform: scale(0.98); }
        .btn-main:disabled { background: #334155; color: #64748b; box-shadow: none; }

        /* Shop & Friends items */
        .item-row { display: flex; align-items: center; justify-content: space-between; padding: 15px; background: #00000020; border-radius: 15px; margin-bottom: 10px; }
        .item-info { text-align: left; }
        .btn-sm { background: var(--gold); border: none; padding: 8px 15px; border-radius: 10px; font-weight: bold; font-size: 12px; }

        /* History */
        .hist-card { font-size: 13px; text-align: left; max-height: 200px; overflow-y: auto; }
        .hist-row { display: flex; justify-content: space-between; padding: 10px 0; border-bottom: 1px solid #ffffff05; }
        .status-Pending { color: #f59e0b; }
        .status-Done { color: #10b981; }

        /* Navigation */
        .nav { position: fixed; bottom: 0; width: 100%; display: flex; background: var(--card); border-top: 1px solid #ffffff10; padding-bottom: env(safe-area-inset-bottom); }
        .nav-item { flex: 1; text-align: center; padding: 15px 0; font-size: 11px; color: #64748b; transition: 0.3s; }
        .nav-item.active { color: var(--gold); background: radial-gradient(circle, #ffb70310 0%, transparent 70%); }
        .nav-item i { display: block; font-size: 20px; margin-bottom: 4px; }

        .tab { display: none; }
        .tab.active { display: block; animation: fadeIn 0.3s; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body>

<div class="header">
    <div class="user-badge" id="user-name">ƒêang t·∫£i...</div>
    <div class="gold-val" id="gold-display">0</div>
    <div style="font-size: 12px; color: #64748b;">T·ªîNG V√ÄNG S·ªû H·ªÆU</div>
</div>

<div class="content">
    <div id="tab-mine" class="tab active">
        <div class="card">
            <div id="tool-name" style="font-size: 14px; font-weight: bold;">C√îNG C·ª§: CU·ªêC G·ªñ</div>
            <div class="prog-container"><div class="prog-bar" id="mining-prog"></div></div>
            <button class="btn-main" id="btn-mine" onclick="startMining()">‚õè B·∫ÆT ƒê·∫¶U ƒê√ÄO</button>
        </div>
        <div class="card" style="padding: 15px;">
            <div style="display: flex; justify-content: space-between; font-size: 13px;">
                <span>Hi·ªáu su·∫•t: <b id="stat-power">10</b>/s</span>
                <span>Y√™u c·∫ßu: 30s</span>
            </div>
        </div>
    </div>

    <div id="tab-shop" class="tab">
        <h3 style="margin-left: 10px;">N√¢ng c·∫•p thi·∫øt b·ªã</h3>
        <div class="card">
            <div class="item-row">
                <div class="item-info"><b>Cu·ªëc S·∫Øt</b><br><small>+30 v√†ng/gi√¢y</small></div>
                <button class="btn-sm" onclick="buyTool(1, 50000)">50K V√ÄNG</button>
            </div>
            <div class="item-row">
                <div class="item-info"><b>M√°y Khoan</b><br><small>+100 v√†ng/gi√¢y</small></div>
                <button class="btn-sm" onclick="buyTool(2, 200000)">200K V√ÄNG</button>
            </div>
        </div>
    </div>

    <div id="tab-wallet" class="tab">
        <div class="card">
            <h3>R√∫t ti·ªÅn</h3>
            <input type="text" id="wd-info" placeholder="S·ªë Momo ho·∫∑c STK + T√™n" style="width:100%; padding:15px; background:#000; border:1px solid #333; color:#fff; border-radius:12px; margin-bottom:15px; box-sizing:border-box;">
            <button class="btn-main" onclick="requestWithdraw()">R√öT 20,000 V√ÄNG ‚Üí 10K</button>
        </div>
        <div class="card hist-card">
            <h4>L·ªãch s·ª≠ giao d·ªãch</h4>
            <div id="history-list">Ch∆∞a c√≥ giao d·ªãch n√†o.</div>
        </div>
    </div>
</div>

<div class="nav">
    <div class="nav-item active" onclick="showTab('mine', this)">‚õè<br>ƒê√ÄO</div>
    <div class="nav-item" onclick="showTab('shop', this)">üõí<br>SHOP</div>
    <div class="nav-item" onclick="showTab('wallet', this)">üí∞<br>V√ç</div>
</div>

<script>
    const tg = window.Telegram.WebApp;
    tg.expand();
    const SCRIPT_URL = "D√ÅN_LINK_WEB_APP_M·ªöI_C·ª¶A_B·∫†N_V√ÄO_ƒê√ÇY";
    
    let gold = 0, level = 0, isMining = false;
    const userId = tg.initDataUnsafe?.user?.id || "888888";
    const userName = tg.initDataUnsafe?.user?.username || "Guest";

    const TOOLS = [
        { name: "CU·ªêC G·ªñ", power: 10 },
        { name: "CU·ªêC S·∫ÆT", power: 40 },
        { name: "M√ÅY KHOAN", power: 120 }
    ];

    async function loadData() {
        document.getElementById('user-name').innerText = "@" + userName;
        try {
            const res = await fetch(`${SCRIPT_URL}?action=load&userId=${userId}`);
            const data = await res.json();
            gold = parseInt(data.gold) || 0;
            level = parseInt(data.level) || 0;
            renderHistory(data.history);
            updateUI();
        } catch (e) { console.log("L·ªói t·∫£i data"); }
    }

    function updateUI() {
        document.getElementById('gold-display').innerText = gold.toLocaleString();
        document.getElementById('tool-name').innerText = "C√îNG C·ª§: " + TOOLS[level].name;
        document.getElementById('stat-power').innerText = TOOLS[level].power;
    }

    function startMining() {
        if (isMining) return;
        isMining = true;
        let elapsed = 0;
        const dur = 30; 
        const btn = document.getElementById('btn-mine');
        const prog = document.getElementById('mining-prog');

        btn.disabled = true;
        let timer = setInterval(() => {
            elapsed += 0.1;
            prog.style.width = (elapsed / dur) * 100 + "%";
            if (elapsed >= dur) {
                clearInterval(timer);
                gold += TOOLS[level].power * dur;
                isMining = false;
                btn.disabled = false;
                prog.style.width = "0%";
                updateUI();
                saveData();
                tg.HapticFeedback.notificationOccurred('success');
            }
        }, 100);
    }

    function saveData() {
        fetch(SCRIPT_URL, { method: "POST", mode: "no-cors", body: JSON.stringify({ action: "save", userId, gold, level, userName }) });
    }

    async function requestWithdraw() {
        const info = document.getElementById('wd-info').value;
        if (gold < 20000) return alert("Kh√¥ng ƒë·ªß 20,000 v√†ng!");
        if (!info) return alert("Vui l√≤ng nh·∫≠p th√¥ng tin nh·∫≠n ti·ªÅn!");

        await fetch(SCRIPT_URL, { 
            method: "POST", 
            mode: "no-cors", 
            body: JSON.stringify({ action: "withdraw", userId, amount: 20000, info, method: "Momo/Bank" }) 
        });
        
        gold -= 20000;
        updateUI();
        alert("G·ª≠i y√™u c·∫ßu th√†nh c√¥ng! Ch·ªù Admin duy·ªát.");
        loadData();
    }

    function buyTool(idx, price) {
        if (gold < price) return alert("B·∫°n kh√¥ng ƒë·ªß v√†ng!");
        if (level >= idx) return alert("B·∫°n ƒë√£ s·ªü h·ªØu c√¥ng c·ª• n√†y!");
        gold -= price;
        level = idx;
        updateUI();
        saveData();
        alert("N√¢ng c·∫•p th√†nh c√¥ng!");
    }

    function renderHistory(list) {
        if (!list || list.length === 0) return;
        const html = list.map(h => `
            <div class="hist-row">
                <span>R√∫t 20k V√†ng</span>
                <b class="status-${h.status}">${h.status == 'Pending' ? 'ƒêang duy·ªát' : (h.status == 'Done' ? 'Th√†nh c√¥ng' : 'T·ª´ ch·ªëi')}</b>
            </div>
        `).join('');
        document.getElementById('history-list').innerHTML = html;
    }

    function showTab(tabId, el) {
        document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
        document.getElementById('tab-' + tabId).classList.add('active');
        document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
        el.classList.add('active');
    }

    loadData();
</script>
</body>
</html>
