<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>‚õè ƒê√ÄO V√ÄNG PRO</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        :root { --p: #ffb703; --s: #fb8500; --bg: #f4f4f4; }
        body { margin: 0; font-family: sans-serif; background: var(--bg); padding-bottom: 80px; }
        .tab-content { display: none; padding: 15px; }
        .active-tab { display: block; }
        .card { background: #fff; padding: 15px; border-radius: 15px; margin-bottom: 15px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); text-align: center; }
        .gold-text { font-size: 35px; font-weight: 900; color: var(--s); }
        .btn { background: var(--p); border: none; padding: 12px; border-radius: 10px; width: 100%; font-weight: bold; cursor: pointer; }
        .nav { position: fixed; bottom: 0; width: 100%; display: flex; background: #fff; border-top: 1px solid #ddd; }
        .nav div { flex: 1; text-align: center; padding: 12px; font-size: 11px; color: #777; }
        .nav .active { color: var(--s); font-weight: bold; }
        .history-item { display: flex; justify-content: space-between; padding: 8px; border-bottom: 1px solid #eee; font-size: 12px; }
        .status-Pending { color: orange; } .status-Done { color: green; font-weight: bold; } .status-Cancel { color: red; }
    </style>
</head>
<body>

<div id="mine" class="tab-content active-tab">
    <div class="card">
        <p id="user-info">Xin ch√†o!</p>
        <div class="gold-text" id="gold-display">0</div>
        <p id="tool-display">Cu·ªëc g·ªó</p>
        <div style="background:#eee; height:10px; border-radius:5px; margin:10px 0;"><div id="progress" style="background:var(--s); width:0%; height:100%; border-radius:5px;"></div></div>
        <button class="btn" id="mine-btn" onclick="mine()">‚õè B·∫ÆT ƒê·∫¶U ƒê√ÄO</button>
    </div>
</div>

<div id="shop" class="tab-content">
    <div class="card">
        <h3>üõí C·ª≠a h√†ng</h3>
        <p>Cu·ªëc s·∫Øt (X3 t·ªëc ƒë·ªô): 50,000 v√†ng <button onclick="buy(1)">Mua</button></p>
        <p>M√°y khoan (X10 t·ªëc ƒë·ªô): 200,000 v√†ng <button onclick="buy(2)">Mua</button></p>
    </div>
</div>

<div id="wallet" class="tab-content">
    <div class="card">
        <h3>üíé R√∫t Ti·ªÅn</h3>
        <input type="text" id="wd-info" placeholder="S·ªë Momo / STK + T√™n" style="width:90%; padding:10px; margin-bottom:10px;">
        <button class="btn" onclick="withdraw()">G·ª¨I Y√äU C·∫¶U R√öT 20K V√ÄNG</button>
    </div>
    <div class="card">
        <h4>üìú L·ªãch s·ª≠ r√∫t</h4>
        <div id="history-list">ƒêang t·∫£i...</div>
    </div>
</div>

<div id="friends" class="tab-content">
    <div class="card">
        <h3>üë• Tuy·ªÉn Ref</h3>
        <p>M·ªùi 1 b·∫°n nh·∫≠n 5,000 v√†ng!</p>
        <input type="text" id="ref-link" readonly style="width:90%; padding:5px;">
        <button class="btn" onclick="copyRef()">Copy Link</button>
    </div>
</div>

<div class="nav">
    <div onclick="switchTab('mine', this)" class="active">ƒê√†o</div>
    <div onclick="switchTab('shop', this)">Shop</div>
    <div onclick="switchTab('wallet', this)">V√≠</div>
    <div onclick="switchTab('friends', this)">B·∫°n b√®</div>
</div>

<script>
    const tg = window.Telegram.WebApp;
    const SCRIPT_URL = "LINK_C·ª¶A_B·∫†N";
    let gold = 0, level = 0, isMining = false;
    const userId = tg.initDataUnsafe.user.id;
    const userName = tg.initDataUnsafe.user.username;

    // Load d·ªØ li·ªáu
    async function load() {
        let res = await fetch(`${SCRIPT_URL}?action=load&userId=${userId}`);
        let data = await res.json();
        gold = data.gold; level = data.level;
        document.getElementById('gold-display').innerText = gold.toLocaleString();
        
        let histHtml = data.history.map(h => `<div class="history-item"><span>${h.amount}V</span> <span class="status-${h.status}">${h.status}</span></div>`).join('');
        document.getElementById('history-list').innerHTML = histHtml || "Ch∆∞a c√≥ GD";
        document.getElementById('ref-link').value = `https://t.me/BOT_C·ª¶A_B·∫†N?start=${userId}`;
    }

    function mine() {
        if(isMining) return;
        isMining = true;
        let p = 0;
        let timer = setInterval(() => {
            p += 2;
            document.getElementById('progress').style.width = p + "%";
            if(p >= 100) {
                clearInterval(timer);
                gold += (level == 0 ? 100 : (level == 1 ? 300 : 1000));
                document.getElementById('gold-display').innerText = gold.toLocaleString();
                isMining = false;
                save();
            }
        }, 100);
    }

    function save() {
        fetch(SCRIPT_URL, {method: 'POST', body: JSON.stringify({action:'save', userId, gold, level, userName})});
    }

    function withdraw() {
        let info = document.getElementById('wd-info').value;
        if(gold < 20000) return alert("Kh√¥ng ƒë·ªß v√†ng!");
        fetch(SCRIPT_URL, {method: 'POST', body: JSON.stringify({action:'withdraw', userId, amount: 20000, method: 'Momo', info: info})});
        alert("ƒê√£ g·ª≠i y√™u c·∫ßu!");
        load();
    }

    function switchTab(id, el) {
        document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active-tab'));
        document.getElementById(id).classList.add('active-tab');
        document.querySelectorAll('.nav div').forEach(n => n.classList.remove('active'));
        el.classList.add('active');
    }

    load();
</script>
</body>
</html>
