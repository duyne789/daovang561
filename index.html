<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>â› ÄÃ o VÃ ng Auto</title>
<script src="https://telegram.org/js/telegram-web-app.js"></script>
<style>
body{margin:0;font-family:Arial;background:#f2f2f2}
.header{background:#ffb703;padding:12px;text-align:center;font-size:20px;font-weight:bold}
.content{padding:12px 12px 70px}
.card{background:#fff;padding:12px;border-radius:10px;margin-bottom:10px}
.btn{padding:10px 15px;background:#ffb703;border-radius:8px;display:inline-block;cursor:pointer;margin:5px}
.nav{position:fixed;bottom:0;width:100%;display:flex;background:#fff;border-top:1px solid #ddd}
.nav div{flex:1;text-align:center;padding:10px;font-size:13px;cursor:pointer}
.nav .active{color:#ffb703;font-weight:bold}
</style>
</head>
<body>

<div class="header">â› ÄÃ o VÃ ng Auto</div>

<div class="content">

<div id="tab-mine" class="tab">
  <div class="card">
    <b>VÃ ng cá»§a báº¡n</b>
    <div id="gold" style="font-size:22px;color:#ffb703;font-weight:bold">0</div>
    <div id="status" style="font-size:13px;color:#666"></div>
    <div class="btn" onclick="start()">â–¶ Start</div>
    <div class="btn" onclick="stop()">â¹ Stop</div>
  </div>
</div>

<div id="tab-ref" class="tab" style="display:none">
  <div class="card">
    <b>Má»i báº¡n (demo)</b>
    <input id="ref" style="width:100%" readonly>
    <div class="btn" onclick="copyRef()">Copy link</div>
  </div>
</div>

<div id="tab-rank" class="tab" style="display:none">
  <div class="card">
    <b>Leaderboard (demo local)</b>
    <div id="rank"></div>
  </div>
</div>

</div>

<div class="nav">
  <div onclick="show('mine')" class="active">â›</div>
  <div onclick="show('ref')">ğŸ‘¥</div>
  <div onclick="show('rank')">ğŸ†</div>
</div>

<script>
const tg = Telegram.WebApp;
tg.expand();

const INTERVAL = 120; // 2 phÃºt
const MAX_TIME = 20 * 3600; // 20 giá»

let gold = Number(localStorage.getItem("gold")) || 0;
let startTime = Number(localStorage.getItem("startTime")) || 0;
let timer = null;

document.getElementById("ref").value = location.origin + location.pathname + "?ref=" + (tg.initDataUnsafe?.user?.id || "guest");

update();

function start(){
  if(timer) return;
  startTime = Math.floor(Date.now()/1000);
  localStorage.setItem("startTime",startTime);
  timer = setInterval(autoMine, INTERVAL*1000);
  document.getElementById("status").innerText = "â³ Äang Ä‘Ã o tá»± Ä‘á»™ng...";
}

function stop(){
  clearInterval(timer);
  timer=null;
  document.getElementById("status").innerText = "â¹ ÄÃ£ dá»«ng";
}

function autoMine(){
  const now = Math.floor(Date.now()/1000);
  if(now-startTime>=MAX_TIME){
    stop();
    document.getElementById("status").innerText = "â° Háº¿t thá»i gian Ä‘Ã o";
    return;
  }
  const earn = Math.floor(Math.random()*40)+10;
  gold+=earn;
  localStorage.setItem("gold",gold);
  updateRank();
  update();
}

function update(){
  document.getElementById("gold").innerText = gold;
}

function copyRef(){
  navigator.clipboard.writeText(document.getElementById("ref").value);
  alert("ÄÃ£ copy!");
}

function updateRank(){
  let r = JSON.parse(localStorage.getItem("rank")||"[]");
  r.push({g:gold});
  r = r.sort((a,b)=>b.g-a.g).slice(0,10);
  localStorage.setItem("rank",JSON.stringify(r));
  document.getElementById("rank").innerHTML = r.map((x,i)=>`#${i+1} â€” ${x.g} vÃ ng`).join("<br>");
}

function show(name){
  document.querySelectorAll(".tab").forEach(t=>t.style.display="none");
  document.getElementById("tab-"+name).style.display="block";
  document.querySelectorAll(".nav div").forEach(d=>d.classList.remove("active"));
  event.target.classList.add("active");
}
</script>

</body>
</html>
